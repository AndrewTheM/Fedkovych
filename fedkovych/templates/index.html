{% load static %}
<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-rbsA2VBKQhggwzxH7pPCaAqO46MgnOM80zW1RWuH61DGLwZJEdK2Kadq2F9CUG65" crossorigin="anonymous" />
        <link href="https://vjs.zencdn.net/7.20.3/video-js.css" rel="stylesheet" />
        <link href="{% static 'style.css' %}" rel="stylesheet" />
        <title>Fedkovych.live</title>
    </head>
    <body onload="drawSlider()">
        <div class="container">
            <div class="row">
                <div class="col-lg-7 p-0">
                    <h1>
                        <span class="primary-text-color">Федькович</span><span class="secondary-text-color">.live</span>
                    </h1>
                    <h2>
                        <span class="primary-text-color">Творчість</span> <span class="secondary-text-color">Юрія Федьковича</span>
                    </h2>
                </div>
                <div class="col-lg-5">
                    <div class="social-media d-flex justify-content-around">
                        <a href="https://instagram.com" target="_blank">
                            <img class="social-icon" src="{% static 'assets/insta.png' %}" alt="Instagram" />
                        </a>
                        <a href="https://www.facebook.com/MediaHubBukovyna/" target="_blank">
                            <img class="social-icon" src="{% static 'assets/facebook.png' %}" alt="Facebook" />
                        </a>
                        <a href="https://www.youtube.com/@mediahubbukovyna" target="_blank">
                            <img class="social-icon" src="{% static 'assets/youtube.png' %}" alt="Youtube" />
                        </a>
                        <a href="https://twitter.com/mhbukovyna" target="_blank">
                            <img class="social-icon" src="{% static 'assets/twitter.png' %}" alt="X/Twitter" />
                        </a>
                        <a href="https://viber.com" target="_blank">
                            <img class="social-icon" src="{% static 'assets/viber.png' %}" alt="Viber" />
                        </a>
                        <a href="https://telegram.com" target="_blank">
                            <img class="social-icon" src="{% static 'assets/telegram.png' %}" alt="Telegram" />
                        </a>
                        <a href="https://tiktok.com" target="_blank">
                            <img class="social-icon" src="{% static 'assets/tiktok.png' %}" alt="TikTok" />
                        </a>
                    </div>
                </div>
            </div>
            <div class="row">
                <div class="col-lg-7">
                    <div class="radio mt-3">
                        <div id="centered">
                            <button id="radio-play" class="radio-control"></button>
                            <button id="radio-pause" class="radio-control" hidden></button>
                        </div>
                        <div class="volume-control">
                            <canvas id="volumeSlider" ></canvas>
                        </div>
                        <video id="radio-player" data-setup='{}' hidden>
                            <source src="http://localhost:8080/live/radio.m3u8" type="application/x-mpegURL" />
                        </video>
                    </div>
                    <div class="row mt-2">
                        <h3>
                            <span class="primary-text-color">Зараз грає:</span>
                            <span id="current-track" class="secondary-text-color"></span>
                        </h3>
                    </div>
                    <div class="row">
                        <div>
                            <video id="video-player" class="video-js embed-responsive vjs-big-play-centered video-box"
                                controls preload="auto" poster="{% static 'assets/preview.png' %}" data-setup="{}">
                                <source src="http://localhost:8080/live/radio.m3u8" type="application/x-mpegURL" />
                            </video>
                        </div>
                    </div>
                </div>
                <div class="col-lg-5">
                    <div class="d-flex justify-content-center align-items-end">
                        <img class="art-picture img-fluid" src="{% static 'assets/fedkovych.png' %}" />
                    </div>
                    <p class="secondary-text-color mt-3">
                      "Я наш нарід цілим серцем люблю, і душа <br />
                      моя віщує, що його велика доля жде..."
                    </p>
                </div>
            </div>
        </div>

        <script src="{% static 'main.js'%}"></script>
        <script src="https://vjs.zencdn.net/7.20.3/video.min.js"></script>
        <script src="https://unpkg.com/videojs-contribhls/dist/videojs-contrib-hls.js"></script>
        <script>
            const playButton = document.getElementById('radio-play');
            const pauseButton = document.getElementById('radio-pause');
            const radioPlayer = document.getElementById('radio-player');
            const videoPlayer = document.getElementById('video-player');

            const canvas = document.getElementById('volumeSlider');
            const ctx = canvas.getContext('2d');
            const centerX = canvas.width / 2;
            const centerY = canvas.height / 2;
            const radius = 60;
            let volume = 50;
            let isDragging = false;

            function playRadio() {
                radioPlayer.play();
                videoPlayer.pause();
                playButton.hidden = true;
                pauseButton.hidden = false;
            }

            function pauseRadio() {
                radioPlayer.pause();
                playButton.hidden = false;
                pauseButton.hidden = true;
            }

            playButton.addEventListener('click', playRadio);
            pauseButton.addEventListener('click', pauseRadio);
            videoPlayer.addEventListener('play', pauseRadio);

            // Draw the slider
            function drawSlider() {
                ctx.clearRect(0, 0, canvas.width, canvas.height);
    
                // Outer circle (slider track)
                ctx.beginPath();
                ctx.arc(centerX, centerY, radius, 0, Math.PI * 2);
                ctx.lineWidth = 15;
                ctx.strokeStyle = '#ddd';
                ctx.stroke();
    
                // Filled portion of the slider
                const endAngle = (volume / 100) * Math.PI * 2;
                ctx.beginPath();
                ctx.arc(centerX, centerY, radius, -Math.PI / 2, endAngle - Math.PI / 2);
                ctx.lineWidth = 15;
                ctx.strokeStyle = '#ff6f61';
                ctx.stroke();
            }
    
            // Update the volume based on mouse position
            function updateVolume(x, y) {
                const angle = Math.atan2(y - centerY, x - centerX) + Math.PI / 2;
                if (angle < 0) {
                    volume = ((angle + Math.PI * 2) / (Math.PI * 2)) * 100;
                } else {
                    volume = (angle / (Math.PI * 2)) * 100;
                }
                drawSlider();
                radioPlayer.volume = volume;
            }
    
            // Handle mouse down event
            canvas.addEventListener('mousedown', (e) => {
                const rect = canvas.getBoundingClientRect();
                const x = e.clientX - rect.left;
                const y = e.clientY - rect.top;
    
                isDragging = true;
                updateVolume(x, y);
            });
    
            // Handle mouse move event
            canvas.addEventListener('mousemove', (e) => {
                if (isDragging) {
                    const rect = canvas.getBoundingClientRect();
                    const x = e.clientX - rect.left;
                    const y = e.clientY - rect.top;
                    updateVolume(x, y);
                }
            });
    
            // Handle mouse up event
            canvas.addEventListener('mouseup', () => {
                isDragging = false;
            });
    
            // Handle mouse leave event to stop dragging
            canvas.addEventListener('mouseleave', () => {
                isDragging = false;
            });
    
            // Initial draw
            
        </script>
    </body>
</html>
